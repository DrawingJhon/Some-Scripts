local remote
for i, v in pairs(game.ReplicatedStorage:GetDescendants()) do
	if v:IsA("RemoteFunction") and v.Name:lower():match("respawn") then
		remote = v
	end
end

if _G.ResetChar then
	_G.ResetChar()
end

local respawning = false
local lastCF
local humanConn
local function charAdded(char)
	local human = char:WaitForChild("Humanoid", 3)
	local root = char:WaitForChild("HumanoidRootPart", 3)
	
	if humanConn then
		humanConn:Disconnect()
	end
	
	if lastCF and respawning then
		respawning = false
		spawn(function()
			root.CFrame = lastCF
		end)
	end
	
	humanConn = human.Died:Connect(function()
		lastCF = root.CFrame
		task.wait()
		respawning = true
		remote:InvokeServer()
	end)
end

local player = game.Players.LocalPlayer
if player.Character then
	task.spawn(charAdded, player.Character)
end

local c = player.CharacterAdded:Connect(charAdded)
local run = true

_G.ResetChar = function()
	c:Disconnect()
	run = false
	if humanConn then
		humanConn:Disconnect()
	end
end

local function getHuman()
	return player.Character and player.Character:FindFirstChildOfClass("Humanoid")
end

while run and task.wait(0.1) do
	local human = getHuman()
	if (human and human.Health < 0.01) or not human then
		remote:InvokeServer()
	end
end
